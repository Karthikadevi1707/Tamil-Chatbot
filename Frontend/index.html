<!DOCTYPE html>
<html lang="ta">
<head>
<meta charset="UTF-8">
<title>AI PDF Assistant</title>

<style>
body{
    margin:0;
    font-family:Arial;
    background:linear-gradient(135deg,#141e30,#243b55);
    display:flex;
    flex-direction:column;
    height:100vh;
}

#chatArea{
    flex:1;
    padding:20px;
    overflow-y:auto;
    display:flex;
    flex-direction:column;
}

.message{
    max-width:80%;
    padding:12px;
    margin:10px 0;
    border-radius:12px;
}

.user{
    background:white;
    align-self:flex-end;
}

.bot{
    background:#e3f2fd;
    align-self:flex-start;
}

.input-area{
    display:flex;
    padding:10px;
    background:white;
}

input[type="text"]{
    flex:1;
    padding:10px;
    font-size:16px;
}

button{
    padding:8px 12px;
    margin-left:5px;
    cursor:pointer;
}

.upload-area{
    padding:10px;
    background:white;
    display:flex;
    gap:10px;
}
</style>
</head>

<body>

<div class="upload-area">
    <input type="file" id="pdfFile">
    <button onclick="uploadPDF()">üìÑ Upload PDF</button>
</div>

<div id="chatArea"></div>

<div class="input-area">
    <input type="text" id="userInput" placeholder="Question number or type your question">
    <button onclick="sendMessage()">Send</button>
    <button onclick="startVoice()" id="micBtn">üé§</button>
</div>

<script>

async function uploadPDF(){

    const file = document.getElementById("pdfFile").files[0];
    if(!file){
        alert("Select PDF file");
        return;
    }

    const formData = new FormData();
    formData.append("file", file);

    const res = await fetch("http://127.0.0.1:8000/upload-pdf",{
        method:"POST",
        body:formData
    });

    const data = await res.json();

    const chatArea = document.getElementById("chatArea");

    if(data.error){
        chatArea.innerHTML += `<div class="message bot">${data.error}</div>`;
    }else{
        chatArea.innerHTML += `<div class="message bot">‚úÖ PDF Uploaded<br>Total Questions: ${data.total_questions}</div>`;
    }

    chatArea.scrollTop = chatArea.scrollHeight;
}

async function sendMessage(){

    const input = document.getElementById("userInput");
    const message = input.value.trim();
    if(!message) return;

    const chatArea = document.getElementById("chatArea");

    chatArea.innerHTML += `<div class="message user">${message}</div>`;
    input.value="";

    const res = await fetch("http://127.0.0.1:8000/ask",{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({ question: message })
    });

    const data = await res.json();
    const reply = data.answer || data.error || "No response";

    chatArea.innerHTML += `<div class="message bot">${reply}</div>`;

    speakText(reply);

    chatArea.scrollTop = chatArea.scrollHeight;
}

function speakText(text){
    const speech = new SpeechSynthesisUtterance(text);
    speech.lang="ta-IN";
    speech.rate=1;
    speechSynthesis.speak(speech);
}

function startVoice(){

    if(!('webkitSpeechRecognition' in window)){
        alert("Use Chrome Browser");
        return;
    }

    const recognition = new webkitSpeechRecognition();
    recognition.lang="ta-IN";
    recognition.start();

    document.getElementById("micBtn").innerText="üéôÔ∏è Listening...";

    recognition.onresult=function(event){
        const transcript = event.results[0][0].transcript;
        document.getElementById("userInput").value = transcript;
        sendMessage();
    };

    recognition.onend=function(){
        document.getElementById("micBtn").innerText="üé§";
    };
}

</script>

</body>
</html>
